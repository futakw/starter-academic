{{ $ga := site.Params.marketing.google_analytics | default "" }}
{{ with site.Config.Services.GoogleAnalytics.ID }}{{ $ga = . }}{{ end }}
{{ $gtm := site.Params.marketing.google_tag_manager | default "" }}

{{ if (in (slice (getenv "HUGO_ENV") hugo.Environment) "production") | and $ga | and (not $gtm) }}
{{ $gtag_config := cond site.Params.privacy_pack "{ 'anonymize_ip': true }" "{}" }}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ $ga }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}  
  gtag('js', new Date());
  gtag('config', '{{ $ga }}', {{ $gtag_config | safeJS }});
</script>
{{ end }}
